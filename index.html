<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025í•™ë…„ë„ ì œ1íšŒ ì—°ì• ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --paper-bg: #f4f1ea; --paper-dark: #e8e4d9; --ink-black: #1a1a1a;
            --ink-gray: #4a4a4a; --ink-light: #6a6a6a; --border-color: #2a2a2a;
            --omr-fill: #1a1a1a; --correct-color: #2d5a27; --wrong-color: #8b2020;
        }
        body {
            font-family: 'Nanum Myeongjo', serif;
            background-color: var(--paper-bg);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            color: var(--ink-black); line-height: 1.8; min-height: 100vh;
        }
        .exam-container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }
        .exam-header {
            border: 3px solid var(--border-color); padding: 30px; margin-bottom: 30px;
            position: relative; background: var(--paper-bg);
        }
        .exam-header::before {
            content: ''; position: absolute; top: 8px; left: 8px; right: 8px; bottom: 8px;
            border: 1px solid var(--border-color); pointer-events: none;
        }
        .exam-year { font-size: 14px; letter-spacing: 8px; text-align: center; margin-bottom: 15px; color: var(--ink-gray); }
        .exam-title { font-size: 28px; font-weight: 800; text-align: center; letter-spacing: 6px; margin-bottom: 20px; }
        .exam-subject {
            font-size: 20px; text-align: center; padding: 10px 0;
            border-top: 2px solid var(--border-color); border-bottom: 2px solid var(--border-color);
            letter-spacing: 4px; margin-bottom: 25px;
        }
        .exam-info { display: flex; justify-content: space-between; align-items: center; font-size: 14px; padding-top: 15px; border-top: 1px dashed var(--ink-gray); }
        .exam-info-item { display: flex; align-items: center; gap: 10px; }
        .name-box { border: 1px solid var(--border-color); padding: 5px 20px; min-width: 100px; text-align: center; font-weight: 700; }
        .exam-notice { border: 1px solid var(--border-color); padding: 20px; margin-bottom: 30px; font-size: 13px; background: var(--paper-dark); }
        .exam-notice-title { font-weight: 700; margin-bottom: 10px; font-size: 14px; }
        .exam-notice ul { padding-left: 20px; }
        .exam-notice li { margin-bottom: 5px; }
        .section-header {
            background: var(--ink-black); color: var(--paper-bg); padding: 12px 20px;
            font-size: 16px; font-weight: 700; letter-spacing: 3px; margin: 40px 0 25px 0;
        }
        .questions-container { display: flex; flex-direction: column; gap: 25px; }
        @media (min-width: 769px) {
            .questions-container { column-count: 2; column-gap: 30px; }
            .question-card { break-inside: avoid; margin-bottom: 25px; }
            .section-header { column-span: all; }
        }
        @media (max-width: 768px) {
            .exam-title { font-size: 20px; letter-spacing: 3px; }
            .exam-subject { font-size: 16px; }
            .exam-info { flex-direction: column; gap: 10px; }
        }
        .question-card { border: 1px solid var(--border-color); padding: 20px; background: var(--paper-bg); break-inside: avoid; }
        .question-number { font-weight: 700; margin-bottom: 12px; font-size: 15px; display: flex; justify-content: space-between; align-items: center; }
        .question-points { font-size: 13px; color: var(--ink-gray); font-weight: 400; }
        .question-difficulty { font-size: 12px; color: var(--ink-gray); font-style: italic; }
        .question-text { font-size: 14px; margin-bottom: 15px; text-align: justify; }
        .question-image {
            width: 100%; height: 180px; object-fit: cover;
            filter: grayscale(100%) contrast(1.1); border: 1px solid var(--border-color); margin-bottom: 15px;
        }
        .options-list { list-style: none; }
        .option-item { display: flex; align-items: flex-start; gap: 12px; padding: 8px 10px; margin-bottom: 5px; cursor: pointer; transition: background 0.2s; border-radius: 2px; }
        .option-item:hover { background: var(--paper-dark); }
        .omr-circle {
            width: 22px; height: 22px; border: 2px solid var(--ink-black); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 12px;
            font-weight: 700; flex-shrink: 0; transition: all 0.2s; position: relative;
        }
        .option-item.selected .omr-circle { background: var(--omr-fill); color: var(--paper-bg); }
        .option-item.selected .omr-circle::after {
            content: ''; position: absolute; width: 100%; height: 100%;
            background: var(--omr-fill); border-radius: 50%; animation: markFill 0.3s ease-out;
        }
        @keyframes markFill { from { transform: scale(0); } to { transform: scale(1); } }
        .option-text { font-size: 14px; line-height: 1.6; padding-top: 2px; }
        .submit-section { margin-top: 50px; padding: 30px; border: 2px solid var(--border-color); text-align: center; background: var(--paper-bg); }
        .submit-notice { font-size: 13px; color: var(--ink-gray); margin-bottom: 20px; }
        .submit-btn {
            font-family: 'Nanum Myeongjo', serif; font-size: 16px; font-weight: 700;
            padding: 15px 60px; background: var(--ink-black); color: var(--paper-bg);
            border: none; cursor: pointer; letter-spacing: 3px; transition: all 0.3s;
        }
        .submit-btn:hover { background: var(--ink-gray); transform: translateY(-2px); }
        .submit-btn:active { transform: translateY(0); }
        .submit-btn:disabled { background: var(--ink-light); cursor: not-allowed; transform: none; }
        .admin-btn {
            position: fixed; bottom: 20px; right: 20px; font-family: 'Nanum Myeongjo', serif;
            font-size: 12px; padding: 10px 15px; background: var(--paper-dark);
            border: 1px solid var(--border-color); cursor: pointer; opacity: 0.6; transition: opacity 0.3s;
        }
        .admin-btn:hover { opacity: 1; }
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-overlay.active { display: flex; }
        .modal-content { background: var(--paper-bg); max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-close { position: absolute; top: 15px; right: 15px; font-size: 24px; background: none; border: none; cursor: pointer; font-family: 'Nanum Myeongjo', serif; }
        .result-modal .modal-content { border: 3px solid var(--border-color); padding: 40px; }
        .result-header { text-align: center; border-bottom: 2px solid var(--border-color); padding-bottom: 20px; margin-bottom: 25px; }
        .result-title { font-size: 22px; font-weight: 800; letter-spacing: 4px; margin-bottom: 10px; }
        .result-subtitle { font-size: 14px; color: var(--ink-gray); }
        .result-score { text-align: center; padding: 30px 0; border-bottom: 1px dashed var(--ink-gray); margin-bottom: 25px; }
        .score-label { font-size: 14px; margin-bottom: 10px; }
        .score-value { font-size: 48px; font-weight: 800; }
        .score-total { font-size: 18px; color: var(--ink-gray); }
        .result-grade { text-align: center; padding: 20px; background: var(--paper-dark); margin-bottom: 25px; }
        .grade-label { font-size: 14px; margin-bottom: 8px; }
        .grade-value { font-size: 28px; font-weight: 800; }
        .result-message { text-align: center; font-size: 15px; line-height: 1.8; padding: 20px; border: 1px solid var(--border-color); }
        .result-details { margin-top: 25px; font-size: 13px; }
        .result-details-title { font-weight: 700; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .result-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed var(--paper-dark); }
        .result-item.correct { color: var(--correct-color); }
        .result-item.wrong { color: var(--wrong-color); }
        .admin-modal .modal-content { border: 2px solid var(--border-color); padding: 30px; }
        .admin-title { font-size: 18px; font-weight: 700; text-align: center; margin-bottom: 20px; letter-spacing: 2px; }
        .admin-input-group { margin-bottom: 20px; }
        .admin-input-group label { display: block; font-size: 13px; margin-bottom: 8px; }
        .admin-input { width: 100%; padding: 12px; font-family: 'Nanum Myeongjo', serif; font-size: 14px; border: 1px solid var(--border-color); background: var(--paper-bg); }
        .admin-submit { width: 100%; font-family: 'Nanum Myeongjo', serif; font-size: 14px; font-weight: 700; padding: 12px; background: var(--ink-black); color: var(--paper-bg); border: none; cursor: pointer; letter-spacing: 2px; }
        .admin-error { color: var(--wrong-color); font-size: 13px; text-align: center; margin-top: 10px; display: none; }
        .submissions-list { max-height: 400px; overflow-y: auto; }
        .submission-item { border: 1px solid var(--border-color); padding: 15px; margin-bottom: 10px; background: var(--paper-dark); }
        .submission-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; }
        .submission-score { font-weight: 700; }
        .submission-answers { font-size: 12px; color: var(--ink-gray); }
        .no-submissions { text-align: center; padding: 40px; color: var(--ink-gray); font-size: 14px; }
        .loading-text { text-align: center; padding: 40px; color: var(--ink-gray); font-size: 14px; }
        .exam-footer { text-align: center; margin-top: 50px; padding: 20px; font-size: 12px; color: var(--ink-light); border-top: 1px solid var(--paper-dark); }
    </style>
</head>
<body>
    <div class="exam-container">
        <header class="exam-header">
            <div class="exam-year">2025í•™ë…„ë„</div>
            <h1 class="exam-title">ì—°ì• ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜</h1>
            <div class="exam-subject">ìˆ˜ì™„-ìƒí˜¸ ì˜ì—­</div>
            <div class="exam-info">
                <div class="exam-info-item"><span>ë¬¸í•­ìˆ˜: 8ë¬¸í•­</span></div>
                <div class="exam-info-item"><span>ë°°ì : 31ì  ë§Œì </span></div>
                <div class="exam-info-item">
                    <span>ìˆ˜í—˜ìƒ ì„±ëª…:</span>
                    <div class="name-box">ìƒ í˜¸</div>
                </div>
            </div>
        </header>

        <div class="exam-notice">
            <div class="exam-notice-title">â—ˆ ìˆ˜í—˜ìƒ ì£¼ì˜ì‚¬í•­ â—ˆ</div>
            <ul>
                <li>ëª¨ë“  ë¬¸í•­ì—ëŠ” ë°°ì ì´ í‘œì‹œë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>
                <li>ê° ë¬¸í•­ë‹¹ í•˜ë‚˜ì˜ ë‹µë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                <li>ì‹œí—˜ ì¢…ë£Œ í›„ ì„±ì í‘œê°€ ë°œê¸‰ë©ë‹ˆë‹¤.</li>
                <li>ë³¸ ì‹œí—˜ì˜ ì •ë‹µì— ëŒ€í•œ ì´ì˜ì œê¸°ëŠ” ìˆ˜ì™„ì´ì—ê²Œ ë¬¸ì˜ë°”ëë‹ˆë‹¤.</li>
            </ul>
        </div>

        <main id="questionsArea">
            <div class="section-header">ì œ 1ê³¼ëª©. ê¸°ì–µë ¥ ë° ì¥ì†Œ ì¶”ë¡  ì˜ì—­</div>
            <div class="questions-container" id="section1"></div>
            <div class="section-header">ì œ 2ê³¼ëª©. ì·¨í–¥ ë° ìŠµê´€ íŒŒì•… ì˜ì—­</div>
            <div class="questions-container" id="section2"></div>
            <div class="section-header">ì œ 3ê³¼ëª©. ë””í…Œì¼ ë° ì‹¬í™” íƒêµ¬ ì˜ì—­</div>
            <div class="questions-container" id="section3"></div>
        </main>

        <div class="submit-section">
            <p class="submit-notice">â€» ì œì¶œ í›„ì—ëŠ” ë‹µì•ˆ ìˆ˜ì •ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ì‹ ì¤‘íˆ ê²€í†  í›„ ì œì¶œí•˜ì„¸ìš”.</p>
            <button class="submit-btn" id="submitBtn" onclick="submitExam()">ì œ ì¶œ í•˜ ê¸°</button>
        </div>

        <footer class="exam-footer">
            <p>ë³¸ ì‹œí—˜ì§€ëŠ” ìˆ˜ì™„â™¥ìƒí˜¸ ì»¤í”Œ ì „ìš© ì‹œí—˜ì…ë‹ˆë‹¤.</p>
            <p>ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ë¥¼ ê¸ˆí•©ë‹ˆë‹¤. â“’ 2025 ìˆ˜ì™„ìƒí˜¸ì—°ì• ì—°êµ¬ì†Œ</p>
        </footer>
    </div>

    <button class="admin-btn" onclick="openAdminModal()">ê´€ë¦¬ì</button>

    <div class="modal-overlay result-modal" id="resultModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('resultModal')">&times;</button>
            <div class="result-header">
                <div class="result-title">ì„± ì  í‘œ</div>
                <div class="result-subtitle">2025í•™ë…„ë„ ì œ1íšŒ ì—°ì• ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜</div>
            </div>
            <div class="result-score">
                <div class="score-label">ì·¨ë“ ì ìˆ˜</div>
                <div><span class="score-value" id="finalScore">0</span><span class="score-total">/ 31</span></div>
            </div>
            <div class="result-grade">
                <div class="grade-label">ë“±ê¸‰</div>
                <div class="grade-value" id="finalGrade">-</div>
            </div>
            <div class="result-message" id="resultMessage"></div>
            <div class="result-details">
                <div class="result-details-title">ë¬¸í•­ë³„ ì±„ì  ê²°ê³¼</div>
                <div id="resultDetails"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay admin-modal" id="adminModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('adminModal')">&times;</button>
            <div class="admin-title">ê´€ë¦¬ì ì¸ì¦</div>
            <div class="admin-input-group">
                <label for="adminPassword">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
                <input type="password" id="adminPassword" class="admin-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
            </div>
            <button class="admin-submit" onclick="verifyAdmin()">í™• ì¸</button>
            <div class="admin-error" id="adminError">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <div class="modal-overlay admin-modal" id="submissionsModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('submissionsModal')">&times;</button>
            <div class="admin-title">ì œì¶œ ë‚´ì—­</div>
            <div class="submissions-list" id="submissionsList"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, orderBy, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDJyTuP_D1YFeVoyP0GWccDJrlJteF-jbE",
            authDomain: "love-ability-test-2025.firebaseapp.com",
            projectId: "love-ability-test-2025",
            storageBucket: "love-ability-test-2025.firebasestorage.app",
            messagingSenderId: "498893628036",
            appId: "1:498893628036:web:d01321353229857a4898d1",
            measurementId: "G-ZZT9VH89TH"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.firebaseDB = db;
        window.firebaseAddDoc = addDoc;
        window.firebaseCollection = collection;
        window.firebaseGetDocs = getDocs;
        window.firebaseOrderBy = orderBy;
        window.firebaseQuery = query;
        console.log("Firebase ì´ˆê¸°í™” ì™„ë£Œ!");
    </script>

    <script>
        const quizData = [
            { id: 1, section: 1, question: "ë‹¤ìŒ ì œì‹œëœ ì‚¬ì§„ì€ ë‘ ì‚¬ëŒì´ ë´„ì— ë°©ë¬¸í–ˆë˜ ì¥ì†Œì´ë‹¤. ì‚¬ì§„ ì† ì¥ì†Œì—ì„œ ë°œìƒí–ˆë˜ ì‚¬ê±´ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?", hasImage: true, imageUrl: "images/love_01.JPG", points: 3, options: ["ì£¼ì°¨í•  ê³³ì„ ë°”ë¡œ ì°¾ì•„ì„œ ë¹ ë¥´ê²Œ ì£¼ì°¨í–ˆë‹¤.", "ìƒí˜¸ê°€ ë©”ë‰´ ì£¼ë¬¸ì„ ì˜ëª»í•´ì„œ ìˆ˜ì™„ì´í•œí…Œ í˜¼ë‚¬ë‹¤.", "ë„ˆë¬´ ë§›ìˆì–´ì„œ ë‘˜ ë‹¤ ë§ì—†ì´ ë°¥ë§Œ ë¨¹ì—ˆë‹¤.", "ì‹ë‹¹ ì£¼ì°¨ë¹„ë¡œ 65,000ì›ì´ ë‚˜ì™”ë‹¤."], correctAnswer: 3 },
            { id: 2, section: 1, question: "ë‹¤ìŒì€ ë‘ ì‚¬ëŒì´ 100ì¼ì„ ê¸°ë…í•˜ì—¬ ë°©ë¬¸í–ˆë˜ ì‹ë‹¹ì˜ ìŒì‹ ì‚¬ì§„ì´ë‹¤. ì´ ë‚  ì‹ì‚¬ë¥¼ ë§ˆì¹œ í›„ ë‘ ì‚¬ëŒì´ ì´ë™í•œ ì¥ì†Œë¡œ ì•Œë§ì€ ê²ƒì€?", hasImage: true, imageUrl: "images/love_02.JPG", points: 4, options: ["ì¼€ì´í¬ ì „ë¬¸ì ì— ê°€ì„œ ì¼€ì´í¬ë¥¼ ë§Œë“¤ì—ˆë‹¤.", "ë¶€í‰CGVì—ì„œ F1ì„ ê´€ëŒí–ˆë‹¤.", "ìŒë£Œë¥¼ ë§ˆì‹œë©° ë¶€í‰ ì¢…í•© ì‹œì¥ì„ êµ¬ê²½í–ˆë‹¤.", "ìˆ˜ì™„ì´ ì§‘ìœ¼ë¡œ ê°€ì„œ 2ì°¨ë¥¼ ì‹œì‘í–ˆë‹¤."], correctAnswer: 0 },
            { id: 3, section: 1, question: "ë‹¤ìŒ ì‚¬ì§„ì˜ ë°°ê²½ì´ ë˜ëŠ” ì¥ì†ŒëŠ” ì–´ë””ì¸ê°€?", hasImage: true, imageUrl: "images/love_03.JPG", points: 5, difficulty: "ë‚œì´ë„ ìƒ", options: ["í™ëŒ€ì…êµ¬ì—­ ë§›ì§‘", "ê±´ëŒ€ì…êµ¬ì—­ ë§›ì§‘", "ì—¬ì˜ë„ ë§›ì§‘", "ì„ì´Œí˜¸ìˆ˜ ë§›ì§‘"], correctAnswer: 2 },
            { id: 4, section: 2, question: "ë‹¤ìŒ ì¤‘ ìˆ˜ì™„ì´ê°€ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ë¸Œëœë“œì™€ ë©”ë‰´ê°€ ì˜¬ë°”ë¥´ê²Œ ì§ì§€ì–´ì§„ ê²ƒì€?", hasImage: false, points: 3, options: ["[ì—½ê¸°ë–¡ë³¶ì´] - [ë§¤ìš´ë§›]", "[ë¡¯ë°ë¦¬ì•„] - [ìƒˆìš°ë²„ê±°]", "[ë©”ê°€ì»¤í”¼] - [ë§ì°¨ë¼ë–¼]", "[ë³¸ì£½] - [ì‡ ê³ ê¸°ì•¼ì±„ì£½]"], correctAnswer: 2 },
            { id: 5, section: 2, question: "ìƒí˜¸ê°€ í‰ì†Œì— ìˆ˜ì™„ì´ì—ê²Œ ê°€ì¥ ìì£¼ í•˜ëŠ” ì”ì†Œë¦¬(í˜¹ì€ ë§ë²„ë¦‡)ë¡œ ì˜³ì€ ê²ƒì€?", hasImage: false, points: 4, options: ['"ë°¥ì€ ë¨¹ê³  í•˜ëŠ” ê±°ì§€?"', '"ë³´ê³ ì‹¶ì–´"', '"ë”°ëœ»í•˜ê²Œ ì…ì—‰"', '"ë„ˆë¬´ ì˜ˆìœ ê±° ì•„ë‹ˆì•¼?"'], correctAnswer: 0 },
            { id: 6, section: 2, question: "ë‘ ì‚¬ëŒì´ ì²˜ìŒìœ¼ë¡œ ê°™ì´ ë´¤ë˜ ì˜í™”ì˜ ì œëª©ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?", hasImage: false, points: 3, options: ["28ë…„í›„", "ìŠ¹ë¶€", "ì–¼êµ´", "ê·€ë©¸ì˜ì¹¼ë‚ "], correctAnswer: 3 },
            { id: 7, section: 3, question: "ë‹¤ìŒ ì‚¬ì§„ì€ 5ì›” 6ì¼ì— ì°ì€ ê²ƒì´ë‹¤. ì´ë‚  ìƒí˜¸ê°€ ì…ê³  ìˆì—ˆë˜ ì•„ìš°í„°ì˜ ì‹¤ì œ ìƒ‰ìƒì€ ë¬´ì—‡ì¸ê°€?", hasImage: true, imageUrl: "images/love_04.JPG", points: 5, options: ["ì°¨ì½œ ê·¸ë ˆì´", "ë„¤ì´ë¹„", "ë”¥ í¬ë ˆìŠ¤íŠ¸ ê·¸ë¦°", "ì œíŠ¸ ë¸”ë™"], correctAnswer: 1 },
            { id: 8, section: 3, question: "ìˆ˜ì™„ì´ê°€ ìƒí˜¸ì—ê²Œ ì²˜ìŒìœ¼ë¡œ ì„ ë¬¼í–ˆë˜ ì•„ì´í…œì€ ë¬´ì—‡ì¸ê°€?", hasImage: false, points: 4, options: ["ë‹ˆíŠ¸", "í¸ì§€", "ì•Œë¶€ë¯¼", "ì†Œê³ ê¸°"], correctAnswer: 0 }
        ];

        let userAnswers = {};
        const ADMIN_PASSWORD = "zzzacs1";
        const gradeThresholds = [
            { min: 28, grade: "1ë“±ê¸‰", message: "ì™„ë²½í•´ìš”! ë‹¹ì‹ ì€ ì§„ì •í•œ ì—°ì¸ì…ë‹ˆë‹¤ ğŸ’•" },
            { min: 24, grade: "2ë“±ê¸‰", message: "í›Œë¥­í•´ìš”! ê±°ì˜ ë‹¤ ë§ì•˜ì–´ìš” âœ¨" },
            { min: 19, grade: "3ë“±ê¸‰", message: "ì¢‹ì•„ìš”! ì¡°ê¸ˆë§Œ ë” ê´€ì‹¬ì„ ê°€ì ¸ë³¼ê¹Œìš”? ğŸ’" },
            { min: 14, grade: "4ë“±ê¸‰", message: "ê´œì°®ì•„ìš”! ì•ìœ¼ë¡œ ë” ë§ì€ ì¶”ì–µì„ ìŒ“ì•„ê°€ìš” ğŸŒ¸" },
            { min: 8, grade: "5ë“±ê¸‰", message: "ìŒ... ë°ì´íŠ¸ë¥¼ ë” ìì£¼ í•´ì•¼ê² ì–´ìš” ğŸ˜…" },
            { min: 0, grade: "6ë“±ê¸‰", message: "ìˆ˜ì™„ì´ì—ê²Œ í˜¼ë‚˜ê¸° ì „ì— ë³µìŠµí•˜ì„¸ìš”! ğŸ“š" }
        ];

        function renderQuestions() {
            for (let section = 1; section <= 3; section++) {
                const sectionQuestions = quizData.filter(q => q.section === section);
                const container = document.getElementById(`section${section}`);
                sectionQuestions.forEach(q => { container.innerHTML += createQuestionHTML(q); });
            }
        }

        function createQuestionHTML(q) {
            const circleNumbers = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£'];
            let optionsHTML = q.options.map((opt, idx) => `
                <li class="option-item" onclick="selectOption(${q.id}, ${idx})">
                    <div class="omr-circle">${circleNumbers[idx]}</div>
                    <span class="option-text">${opt}</span>
                </li>
            `).join('');
            return `
                <div class="question-card" id="question-${q.id}">
                    <div class="question-number">
                        <span>ë¬¸ì œ ${q.id}.</span>
                        <span>${q.difficulty ? `<span class="question-difficulty">(${q.difficulty})</span>` : ''}<span class="question-points">(${q.points}ì )</span></span>
                    </div>
                    ${q.hasImage ? `<img src="${q.imageUrl}" alt="ë¬¸ì œ ${q.id} ì´ë¯¸ì§€" class="question-image" onerror="this.src='https://placehold.co/400x300?text=ì´ë¯¸ì§€+ì¤€ë¹„ì¤‘'">` : ''}
                    <p class="question-text">${q.question}</p>
                    <ul class="options-list" id="options-${q.id}">${optionsHTML}</ul>
                </div>
            `;
        }

        function selectOption(questionId, optionIndex) {
            userAnswers[questionId] = optionIndex;
            const optionsList = document.getElementById(`options-${questionId}`);
            const options = optionsList.querySelectorAll('.option-item');
            options.forEach((opt, idx) => {
                if (idx === optionIndex) opt.classList.add('selected');
                else opt.classList.remove('selected');
            });
        }

        async function submitExam() {
            const answeredCount = Object.keys(userAnswers).length;
            if (answeredCount < quizData.length) {
                const unanswered = quizData.length - answeredCount;
                if (!confirm(`ì•„ì§ ${unanswered}ë¬¸ì œë¥¼ í’€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            }
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì œì¶œ ì¤‘...';

            let totalScore = 0;
            let detailsHTML = '';
            const circleNumbers = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£'];
            quizData.forEach(q => {
                const userAnswer = userAnswers[q.id];
                const isCorrect = userAnswer === q.correctAnswer;
                if (isCorrect) totalScore += q.points;
                const userAnswerText = userAnswer !== undefined ? circleNumbers[userAnswer] : 'ë¯¸ì‘ë‹µ';
                const statusClass = isCorrect ? 'correct' : 'wrong';
                const statusText = isCorrect ? 'â—‹' : 'âœ•';
                detailsHTML += `<div class="result-item ${statusClass}"><span>ë¬¸ì œ ${q.id} (${q.points}ì )</span><span>${userAnswerText} ${statusText}</span></div>`;
            });

            let grade = gradeThresholds.find(g => totalScore >= g.min);
            document.getElementById('finalScore').textContent = totalScore;
            document.getElementById('finalGrade').textContent = grade.grade;
            document.getElementById('resultMessage').textContent = grade.message;
            document.getElementById('resultDetails').innerHTML = detailsHTML;

            await saveToFirebase(totalScore, userAnswers, grade.grade);
            submitBtn.disabled = false;
            submitBtn.textContent = 'ì œ ì¶œ í•˜ ê¸°';
            document.getElementById('resultModal').classList.add('active');
        }

        async function saveToFirebase(score, answers, grade) {
            const submission = { score, grade, answers, timestamp: new Date().toISOString(), totalQuestions: quizData.length, maxScore: 31 };
            try {
                if (window.firebaseDB && window.firebaseAddDoc && window.firebaseCollection) {
                    const docRef = await window.firebaseAddDoc(window.firebaseCollection(window.firebaseDB, "submissions"), submission);
                    console.log("Firebase ì €ì¥ ì„±ê³µ! Document ID:", docRef.id);
                } else {
                    console.log("Firebase ë¡œë”© ì¤‘... ë¡œì»¬ ì €ì¥ìœ¼ë¡œ ëŒ€ì²´");
                    saveToLocalStorage(submission);
                }
            } catch (error) {
                console.error("Firebase ì €ì¥ ì‹¤íŒ¨:", error);
                saveToLocalStorage(submission);
            }
        }

        function saveToLocalStorage(submission) {
            let submissions = JSON.parse(localStorage.getItem('examSubmissions') || '[]');
            submissions.push(submission);
            localStorage.setItem('examSubmissions', JSON.stringify(submissions));
        }

        function closeModal(modalId) { document.getElementById(modalId).classList.remove('active'); }
        function openAdminModal() {
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminError').style.display = 'none';
            document.getElementById('adminModal').classList.add('active');
        }

        function verifyAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) { closeModal('adminModal'); showSubmissions(); }
            else { document.getElementById('adminError').style.display = 'block'; }
        }

        async function showSubmissions() {
            const listContainer = document.getElementById('submissionsList');
            const circleNumbers = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£'];
            listContainer.innerHTML = '<div class="loading-text">ë°ì´í„° ë¡œë”© ì¤‘...</div>';
            document.getElementById('submissionsModal').classList.add('active');

            try {
                let submissions = [];
                if (window.firebaseDB && window.firebaseGetDocs && window.firebaseCollection) {
                    const q = window.firebaseQuery(window.firebaseCollection(window.firebaseDB, "submissions"), window.firebaseOrderBy("timestamp", "desc"));
                    const querySnapshot = await window.firebaseGetDocs(q);
                    querySnapshot.forEach((doc) => { submissions.push(doc.data()); });
                }
                const localSubmissions = JSON.parse(localStorage.getItem('examSubmissions') || '[]');
                if (localSubmissions.length > 0) {
                    submissions = [...submissions, ...localSubmissions];
                    submissions.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                }
                if (submissions.length === 0) {
                    listContainer.innerHTML = '<div class="no-submissions">ì•„ì§ ì œì¶œëœ ë‹µì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    let html = '';
                    submissions.forEach((sub) => {
                        const date = new Date(sub.timestamp);
                        const dateStr = `${date.getFullYear()}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
                        let answersStr = Object.entries(sub.answers).sort((a, b) => Number(a[0]) - Number(b[0])).map(([qId, ans]) => `${qId}ë²ˆ:${circleNumbers[ans]}`).join(', ');
                        html += `<div class="submission-item"><div class="submission-header"><span>${dateStr}</span><span class="submission-score">${sub.score}ì  / 31ì  (${sub.grade || '-'})</span></div><div class="submission-answers">ë‹µì•ˆ: ${answersStr}</div></div>`;
                    });
                    listContainer.innerHTML = html;
                }
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                listContainer.innerHTML = '<div class="no-submissions">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        document.getElementById('adminPassword').addEventListener('keypress', function(e) { if (e.key === 'Enter') verifyAdmin(); });
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) { if (e.target === this) this.classList.remove('active'); });
        });
        document.addEventListener('DOMContentLoaded', renderQuestions);
    </script>
</body>
</html>
